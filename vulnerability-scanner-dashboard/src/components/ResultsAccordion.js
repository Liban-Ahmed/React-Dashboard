import React from "react";
import {
  Accordion,
  AccordionSummary,
  AccordionDetails,
  Typography,
  Table,
  TableBody,
  TableCell,
  TableContainer,
  TableHead,
  TableRow,
  Paper,
} from "@mui/material";
import ExpandMoreIcon from "@mui/icons-material/ExpandMore";

function ResultsAccordion({ results }) {
  if (!results || Object.keys(results).length === 0) {
    return <Typography>No results to display</Typography>;
  }

  return (
    <div>
      {Object.entries(results).map(([url, scans], index) => (
        <Accordion key={index}>
          <AccordionSummary expandIcon={<ExpandMoreIcon />}>
            <Typography>{url}</Typography>
          </AccordionSummary>
          <AccordionDetails>
            {Object.entries(scans).map(([scanType, findings], idx) => (
              <div key={idx}>
                <Typography variant="h6">{scanType}</Typography>
                <TableContainer component={Paper} sx={{ mt: 2 }}>
                  <Table>
                    <TableHead>
                      <TableRow>
                        <TableCell>Payload/Path</TableCell>
                        <TableCell>Status</TableCell>
                        <TableCell>Risk Level</TableCell>
                      </TableRow>
                    </TableHead>
                    <TableBody>
                      {findings.map((finding, i) => (
                        <TableRow key={i}>
                          <TableCell>
                            {finding.payload || finding.path || "N/A"}
                          </TableCell>
                          <TableCell>
                            <Typography
                              color={finding.vulnerable ? "error" : "success"}
                            >
                              {finding.vulnerable
                                ? "Vulnerable"
                                : "Not Vulnerable"}
                            </Typography>
                          </TableCell>
                          <TableCell>{finding.risk || "None"}</TableCell>
                        </TableRow>
                      ))}
                    </TableBody>
                  </Table>
                </TableContainer>
              </div>
            ))}
          </AccordionDetails>
        </Accordion>
      ))}
    </div>
  );
}

export default ResultsAccordion;
